#include <stdio.h>
#include <string.h>

struct date {
    int day, month, year;
};

struct employee {
    int id;
    char name[50];
    char department[20];
    char designation[20];
    float salary;

    struct date joiningDate;

    char phone[20];
    char email[50];
};

int calculateExperience(struct date join, struct date today) {
    int years = today.year - join.year;

    if (today.month < join.month || 
       (today.month == join.month && today.day < join.day))
    {
        years--;
    }

    return years;
}

void display(struct employee e, int experience) {
    printf("\n--------------------------------\n");
    printf("ID: %d\n", e.id);
    printf("Name: %s\n", e.name);
    printf("Department: %s\n", e.department);
    printf("Designation: %s\n", e.designation);
    printf("Salary: %.2f\n", e.salary);
    printf("Phone: %s\n", e.phone);
    printf("Email: %s\n", e.email);
    printf("Joined: %02d-%02d-%04d\n", e.joiningDate.day, e.joiningDate.month, e.joiningDate.year);
    printf("Experience: %d years\n", experience);
    printf("--------------------------------\n");
}

void applyAppraisal(struct employee *e, float rate) {
    e->salary += e->salary * (rate / 100);
}

int main() {
    int n, i;
    struct date today;

    printf("Enter today's date (dd mm yyyy): ");
    scanf("%d %d %d", &today.day, &today.month, &today.year);

    printf("How many employees? ");
    scanf("%d", &n);

    struct employee emp[n];

    for (i = 0; i < n; i++) {
        printf("\nEnter details for employee %d\n", i + 1);

        printf("Employee ID: ");
        scanf("%d", &emp[i].id);

        printf("Name: ");
        scanf("%s", emp[i].name);

        printf("Department (IT/HR/Finance/Marketing/Operations): ");
        scanf("%s", emp[i].department);

        printf("Designation (Intern/Junior/Senior/Manager/Director): ");
        scanf("%s", emp[i].designation);

        printf("Salary: ");
        scanf("%f", &emp[i].salary);

        printf("Joining Date (dd mm yyyy): ");
        scanf("%d %d %d", &emp[i].joiningDate.day, &emp[i].joiningDate.month, &emp[i].joiningDate.year);

        printf("Phone: ");
        scanf("%s", emp[i].phone);

        printf("Email: ");
        scanf("%s", emp[i].email);
    }

    int choice;

    while (1) {
        printf("\n------------- MENU -------------\n");
        printf("1. Display All Employees\n");
        printf("2. Department-wise Salary Statistics\n");
        printf("3. Apply Annual Appraisal\n");
        printf("4. Search by Department\n");
        printf("5. Search by Designation\n");
        printf("6. Search by Minimum Experience\n");
        printf("7. Show Employees Eligible for Promotion\n");
        printf("8. Exit\n");
        printf("--------------------------------\n");

        printf("Enter your choice: ");
        scanf("%d", &choice);

        char dept[20], desig[20];
        int minExp;
        float appraisalRate;
        int experience;

        switch (choice) {

            case 1:
                for (i = 0; i < n; i++) {
                    experience = calculateExperience(emp[i].joiningDate, today);
                    display(emp[i], experience);
                }
                break;

            case 2: {
                char dep[20];
                printf("Enter department: ");
                scanf("%s", dep);

                int count = 0;
                float sum = 0, max = -1, min = 999999;

                for (i = 0; i < n; i++) {
                    if (strcmp(emp[i].department, dep) == 0) {
                        count++;
                        sum += emp[i].salary;

                        if (emp[i].salary > max) max = emp[i].salary;
                        if (emp[i].salary < min) min = emp[i].salary;
                    }
                }

                if (count == 0) {
                    printf("No employees found in this department.\n");
                } else {
                    printf("Total Employees: %d\n", count);
                    printf("Average Salary: %.2f\n", sum / count);
                    printf("Highest Salary: %.2f\n", max);
                    printf("Lowest Salary: %.2f\n", min);
                }

                break;
            }

            case 3:
                printf("Enter appraisal percentage (5 - 15): ");
                scanf("%f", &appraisalRate);

                for (i = 0; i < n; i++) {
                    applyAppraisal(&emp[i], appraisalRate);
                }

                printf("Appraisal applied successfully!\n");
                break;

            case 4:
                printf("Enter department: ");
                scanf("%s", dept);

                for (i = 0; i < n; i++) {
                    if (strcmp(emp[i].department, dept) == 0) {
                        experience = calculateExperience(emp[i].joiningDate, today);
                        display(emp[i], experience);
                    }
                }
                break;

            case 5:
                printf("Enter designation: ");
                scanf("%s", desig);

                for (i = 0; i < n; i++) {
                    if (strcmp(emp[i].designation, desig) == 0) {
                        experience = calculateExperience(emp[i].joiningDate, today);
                        display(emp[i], experience);
                    }
                }
                break;

            case 6:
                printf("Enter minimum experience (years): ");
                scanf("%d", &minExp);

                for (i = 0; i < n; i++) {
                    experience = calculateExperience(emp[i].joiningDate, today);

                    if (experience >= minExp) {
                        display(emp[i], experience);
                    }
                }
                break;

            case 7:
                printf("Employees eligible for promotion (>= 3 years in role):\n");

                for (i = 0; i < n; i++) {
                    experience = calculateExperience(emp[i].joiningDate, today);

                    if (experience >= 3) {
                        display(emp[i], experience);
                    }
                }
                break;

            case 8:
                return 0;

            default:
                printf("Invalid choice. Try again.\n");
        }
    }

    return 0;
}
