#include <stdio.h>
#include <string.h>

struct student {
    char name[50];
    int roll;
    int marks[3];
    float per;
    char grade[3];
};

void assignGrade(struct student *s) {
    if (s->per >= 90)
        strcpy(s->grade, "A+");
    else if (s->per >= 80)
        strcpy(s->grade, "A");
    else if (s->per >= 70)
        strcpy(s->grade, "B+");
    else if (s->per >= 60)
        strcpy(s->grade, "B");
    else if (s->per >= 50)
        strcpy(s->grade, "C");
    else
        strcpy(s->grade, "F");
}

void rankStudents(struct student s[], int n) {
    struct student temp;
    int i, j;

    for(i=0; i<n-1; i++) {
        for(j=i+1; j<n; j++) {
            if(s[j].per > s[i].per) {
                temp = s[i];
                s[i] = s[j];
                s[j] = temp;
            }
        }
    }
}

int main() {
    int n, i, j;

    printf("How many students in your class: ");
    scanf("%d", &n);

    struct student s[n];
    float totalClassMarks = 0;

    for (i = 0; i < n; i++) {
        float sum = 0;

        printf("\nEnter the name of student %d: ", i + 1);
        scanf("%s", s[i].name);

        printf("Enter the roll number of student %d: ", i + 1);
        scanf("%d", &s[i].roll);

        for (j = 0; j < 3; j++) {
            do {
                printf("Enter marks of student %d in subject %d (0-100): ", i + 1, j + 1);
                scanf("%d", &s[i].marks[j]);
            } while (s[i].marks[j] < 0 || s[i].marks[j] > 100);

            sum += s[i].marks[j];
            totalClassMarks += s[i].marks[j];
        }

        s[i].per = (sum / 300) * 100;
        assignGrade(&s[i]);
    }

    float classAvg = totalClassMarks / (n * 3);

    printf("\n--------------------------------------------\n");
    printf("Class Average Marks = %.2f\n", classAvg);
    printf("--------------------------------------------\n");

    printf("\nStudents ABOVE class average:\n");
    for (i = 0; i < n; i++) {
        if (s[i].per > classAvg)
            printf("%s (%.2f%%)\n", s[i].name, s[i].per);
    }

    printf("\nStudents BELOW class average:\n");
    for (i = 0; i < n; i++) {
        if (s[i].per < classAvg)
            printf("%s (%.2f%%)\n", s[i].name, s[i].per);
    }

    rankStudents(s, n);

    printf("\n--------------------------------------------\n");
    printf("STUDENT RANKING (Highest to Lowest)\n");
    for (i = 0; i < n; i++) {
        printf("Rank %d: %s (%.2f%%) Grade: %s\n", i + 1, s[i].name, s[i].per, s[i].grade);
    }

    int choice;
    char searchName[50], gradeSearch[3];
    int searchRoll;

    while (1) {
        printf("\n--------------------------------------------\n");
        printf(" MENU\n");
        printf("1. Search student by roll number\n");
        printf("2. Search student by name\n");
        printf("3. Find students by grade\n");
        printf("4. Show class average again\n");
        printf("5. Exit\n");
        printf("--------------------------------------------\n");
        printf("Enter your choice: ");
        scanf("%d", &choice);

        switch (choice) {

            case 1:
                printf("Enter roll number: ");
                scanf("%d", &searchRoll);
                for (i = 0; i < n; i++) {
                    if (s[i].roll == searchRoll) {
                        printf("Found: %s | %.2f%% | Grade: %s\n", s[i].name, s[i].per, s[i].grade);
                        break;
                    }
                }
                if (i == n) printf("Student NOT FOUND.\n");
                break;

            case 2:
                printf("Enter name: ");
                scanf("%s", searchName);
                for (i = 0; i < n; i++) {
                    if (strcmp(s[i].name, searchName) == 0) {
                        printf("Found: Roll %d | %.2f%% | Grade: %s\n", s[i].roll, s[i].per, s[i].grade);
                        break;
                    }
                }
                if (i == n) printf("Student NOT FOUND.\n");
                break;

            case 3:
                printf("Enter grade (A+, A, B+, B, C, F): ");
                scanf("%s", gradeSearch);
                
                printf("Students with grade %s:\n", gradeSearch);

                int found = 0;
                for (i = 0; i < n; i++) {
                    if (strcmp(s[i].grade, gradeSearch) == 0) {
                        printf("%s (%.2f%%)\n", s[i].name, s[i].per);
                        found = 1;
                    }
                }

                if (!found) printf("No students with this grade.\n");
                break;

            case 4:
                printf("Class Average = %.2f\n", classAvg);
                break;

            case 5:
                return 0;

            default:
                printf("Invalid choice. Try again.\n");
        }
    }

    return 0;
}

